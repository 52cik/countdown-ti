{"version":3,"file":"countdown.js","sources":["../index.js"],"sourcesContent":["/**\n * 什么都不做\n */\nfunction noop() {}\n\n/**\n * 倒计时工具\n *\n * @param {number|string} seconds\n * @param {function} onTick\n * @param {function} onComplete\n */\nfunction countdown(seconds, onTick, onComplete) {\n  let expires = 0; // 到期时间戳 (只精确到秒)\n  let interval = 0; // setTimeout 句柄\n  let isAbort = false; // 是否终止\n\n  if (!onComplete) {\n    onComplete = onTick || noop;\n    onTick = noop;\n  }\n\n  // 设置时间\n  function setTime(sec) {\n    const isTimeStamp = /^(\\d{10}|\\d{13})$/.test(sec); // 时间戳\n    const isString = typeof sec === 'string'; // 时间格式日期字符串\n    const now = parseInt(+new Date() / 1000, 10);\n\n    // 时间参数类型处理\n    if (isTimeStamp) {\n      expires = sec > 1e11 ? parseInt(sec / 1000, 10) : sec;\n    } else if (isString) {\n      expires = parseInt(+new Date(sec) / 1000, 10);\n    } else {\n      expires = now + sec; // 到期时间戳 (只精确到秒)\n    }\n\n    if (expires <= now) {\n      expires -= 1;\n    }\n  }\n\n  const ctrl = {\n    /**\n     * 终止倒计时\n     */\n    abort() {\n      isAbort = true;\n      clearTimeout(interval);\n    },\n    /**\n     * 设置时间\n     */\n    setTime,\n  };\n\n  // 倒计时\n  function tick() {\n    const time = parseInt(expires + 1 - new Date() / 1000, 10); // 剩余时间\n    onTick.call(ctrl, time);\n    if (time <= 0) {\n      onComplete.call(ctrl); // 完成\n    } else if (!isAbort) {\n      interval = setTimeout(tick, 1000);\n    }\n  }\n\n  setTime(seconds); // 设置时间\n  tick(); // 启动\n\n  return ctrl;\n}\n\nexport default countdown;\n"],"names":["noop","seconds","onTick","onComplete","expires","interval","isAbort","setTime","sec","isTimeStamp","test","isString","now","parseInt","Date","ctrl","tick","time","call","setTimeout"],"mappings":"qLAGA,SAASA,YAST,SAAmBC,EAASC,EAAQC,OAC9BC,EAAU,EACVC,EAAW,EACXC,GAAU,WAQLC,EAAQC,OACTC,EAAc,oBAAoBC,KAAKF,GACvCG,EAA0B,iBAARH,EAClBI,EAAMC,UAAU,IAAIC,KAAS,IAAM,OAGrCL,EACc,KAAND,EAAaK,SAASL,EAAM,IAAM,IAAMA,EACzCG,EACCE,UAAU,IAAIC,KAAKN,GAAO,IAAM,IAEhCI,EAAMJ,IAGHI,OACF,GArBVT,MACUD,GAAUF,IACdA,OAuBLe,EAAO,qBAKC,eACGV,wBAmBTJ,YAVCe,QACDC,EAAOJ,SAAST,EAAU,EAAI,IAAIU,KAAS,IAAM,MAChDI,KAAKH,EAAME,GACdA,GAAQ,IACCC,KAAKH,GACNT,MACCa,WAAWH,EAAM,SAOzBD"}